---
title: トランスパイルのデフォルトと設定オプション
description: 既定の設定と設定オプション
---

# トランスパイルのデフォルト設定と設定オプション

バックエンドには基底ゲートが限られており、任意の操作を実行することができないため、抽象回路をトランスパイルする必要があります。 トランスパイラーの機能は、任意の回路を変更して、指定されたバックエンドで実行できるようにすることです。  これは、回路をサポートされる基底ゲートに変換することによって行われます。 必要に応じてSWAPゲートを導入することで、回路の接続がバックエンドの接続と一致するようにします。 

回路とバックエンドを `transpile()` 関数に渡し、すべてのデフォルト設定を使用できます。 パラメータを使ってトランスパイルを微調整することもできます  

## パラメータのない基本的な使用

この例では、パラメータを指定せずに回路とターゲットバックエンドをトランスパイラーに渡します。 

回路を作成し、結果を表示: 

```python
from qiskit import transpile
from qiskit import QuantumCircuit
from qiskit.circuit.library import GroverOperator, Diagonal
from qiskit_ibm_runtime import QiskitRuntimeService
from qiskit.providers.fake_provider import FakeSherbrooke

# Create circuit to test transpiler on
oracle = Diagonal([1] * 7 + [-1])
qc = QuantumCircuit(3)
qc.h([0, 1, 2])
qc = qc.compose(GroverOperator(oracle))

# Add measurements to the circuit
qc.measure_all()

# View the circuit
qc.draw(output='mpl')
```

![Original circuit](/images/transpile/defaults-and-configuration-options/original-circuit.png)

回路を一時的に切り替え、結果を表示します。

```python
# Specify the backend to target
backend = FakeSherbrooke()

# Transpile the circuit
transpiled_circ = transpile(qc, backend)

# View the transpiled circuit
transpiled_circ.draw(output='mpl')
```

![Transpiled circuit](/images/transpile/defaults-and-configuration-options/transpled-circuit.png)

## すべての利用可能なパラメータ

以下は、`transpile()`メソッドで利用可能なパラメータです。  引数には2つのクラスがあります:コンパイルのターゲットを記述するクラスとトランスパイラーの動作に影響を与えるクラスです。

`circuits`以外のパラメータはすべてオプションです。  詳細については、[Transpiler API documentation](/api/qiskit/transpiler#transpiler-api)を参照してください。

`circuits` (`_CircuitT`) - トランスパイルするための1つ以上の回路。 これは唯一必要なパラメータです。

### コンパイルのターゲットを記述するために使用されるパラメータ

これらの引数は、入力回路が実行されるシステムを記述します。  例えば、返された回路を指定されたバックエンドで実行できるようにするために使用することができます。 ここでトランスパイラーは、`coupping_map`で指定されているように接続が制限されている物理的な量子ビットに回路の仮想量子ビットをマッピングします。 バックエンドに対してどの単一および2量子ビットゲートをキャリブレーションするか、そしておそらくそのエラー率を指定する `basis_gates` 。

これらのパラメータの多くは、format@@0(common-parameters) で詳細に説明されています。

<details>
  <summary>
    **バックエンドパラメータ**
  </summary>

**バックエンドパラメータ** - `backend`を指定した場合、`target`や他のバックエンドオプションを指定する必要はありません。 同様に、`target` を指定した場合、バックエンドや他のバックエンドオプションを指定する必要はありません。

-   `backend` (バックエンド) - これが設定されている場合、トランスパイラーは入力回路をこのデバイスにコンパイルします。 `coupping_map`のような設定に影響を与えるオプションが他に設定されている場合は、`backend`から設定を上書きします。
-   `target` (Target) - A backend transpiler target. 通常、これはバックエンド引数の一部として指定されますが、Target オブジェクトを手動で構築する場合は、ここで指定できます。 `backend` からターゲットを上書きします。
-   `backend_properties` (BackendProperties) - ゲートエラー、読み出しエラー、キュービットのコヒーレンス時間など、バックエンドから返されるプロパティ。 `backend.properties()`を実行して、この情報を提供するバックエンドを探します。
-   `dt` (float | None) - バックエンドのサンプル時間 (resolution) (秒単位)。 `None` が指定されている場合 (デフォルト)、`backend.configuration().dt` が使用されます。 
-   `ignore_backend_provided_default_methods` (bool) - `True`に設定すると、バックエンドで指定されたデフォルトのメソッドはすべて無視されます。 バックエンドによっては、バックエンド固有のコンパイルテクニックをサポートするカスタムコンパイルターゲット固有のパス / プラグインをサポートする代替のデフォルトメソッドを指定します。 これらのデフォルトが使用されないことを好む場合、このオプションはバックエンド固有のデフォルトを無効にします。
-   `instruction_durations` (List\[Tuple\[str, Iterable[int], float, Iterable[float], str]] | List\[Tuple\[str, Iterable[int], float, Iterable[float]]] | List\[Tuple\[str, Iterable[int], float, str]] | List\[Tuple\[str, Iterable[int], float]] | InstructionDurations) - Durations of instructions. `scheduling_method` が指定されている場合にのみ適用されます。 `backend.properties` で定義されたゲートの長さはデフォルトで使用されます。 `instruction_durations` が指定されている場合、上書きされます。 `instruction_durations` 形式は以下の通りです。 instruction_durationsはタプル[(instruction_name, qubits, duration, unit), … ]のリストとして指定する必要があります。 | \[(`cx`, [0, 1], 12.3, `ns`), (`u3`, [0], 4.56, `ns`)] | \[(`cx`, [0, 1], 1000), (`u3`, [0], 300)] If `unit` is omitted, the default is `dt`, which is a sample time depending on backend. time単位が`dt`の場合、durationは整数でなければなりません。
-   `timing_constraints` (Dict[str, int] | None) - 命令時間分解能に関する任意の制御ハードウェア制限。 この情報はバックエンドの設定によって提供されます。 バックエンドに命令時間の割り当てに制限がない場合、`timing_constraints` は `None` で調整は行われません。 量子コンピュータバックエンドは、一連の制限を報告するかもしれません。 すなわち:
        \- `granularity`: 最小パルスゲート解像度をdt単位で表す整数値。 ユーザー定義のパルスゲートには、この粒度値の倍数の長さが必要です。
        \- `min_length`: 最小パルスゲート長をdt単位で表す整数値。 ユーザー定義のパルスゲートは、この長さより長くする必要があります。
        \- `pulse_alignment`: ゲート命令開始時刻の時間分解能を表す整数値。 ゲート命令は、この値の倍数である時点で開始する必要があります。 
        \- `getre_alignment`: 測定命令開始時刻の時間分解能を表す整数値。 測定命令は、この値の倍数である時点で開始する必要があります。 
    </details>

<details>
  <summary>
    **レイアウトパラメータ**
  </summary>

-   `basis_gates` (List[str] | None) - アンロールする基底ゲート名のリスト。  例えば['u1', 'u2', 'u3', 'cx']。 `None` の場合は、展開しないでください。
-   `coupling_map` (CouplingMap | List\[List[int]]) - マッピング内でターゲットとする方向カップリングマップ (おそらくカスタム) 。 カップリングマップが対称である場合、両方の方向を指定する必要があります。 以下の形式がサポートされています:
    -   CouplingMap インスタンス
    -   リストは隣接行列として与えられなければなりません。各エントリはバックエンドでサポートされるすべての指定された2量子ビット相互作用を指定します。  例:\[[0, 1], [0, 3], [1, 2], [1, 5], [4, 1], [3]]
-   `inst_map` (List[InstructionScheduleMap] | None) - 回路動作からパルススケジュールへのマッピング。 `None` の場合、バックエンドの `instruction_schedule_map` が使用されます。
    </details>

### トランスパイラーの動作に影響を与えるパラメーター:

これらのパラメータは特定の移調段階に影響します。 それらのいくつかは、複数のステージに影響を与える可能性がありますが、単純化のために1つのステージの下にのみリストされています。 引数を指定した場合、例えば使用したい量子ビットの `initial_layout` のように、その値はそれを変更できるすべてのパスを上書きします。 言い換えれば、トランスパイラーは手動で指定したものを変更しません。 特定のステージの詳細については、format@@0(transpiler-stage) を参照してください。

<details>
  <summary>
    **初期化ステージ**
  </summary>

-   `hls_config` (HLSConfig) - `HighLevelSynthesis`変換パスに直接渡されるオプションの設定クラス`HLSConfig`。 この構成クラスでは、さまざまな高レベルオブジェクトの合成アルゴリズムとパラメータのリストを指定できます。
-   `init_method` (str) - 初期化段階で使用するプラグイン名。 デフォルトでは、外部プラグインは使用されません。 インストールされているプラグインの一覧は `init` で `list_stage_plugins()` を実行することで確認できます。
-   `unitary_synthesis_method` (str) - 使用する単一合成法の名前。 デフォルトでは `default` が使用されます。 インストールされているプラグインの一覧は `unitary_syn_names()` で確認できます。
-   `unitary_themis_plugin_config` (dict) - 単一合成プラグインに直接渡されるオプションの構成辞書。 デフォルトでは、デフォルトの単一合成法ではカスタム構成が取られないため、この設定は効果がありません。 `unitary_シンセサイザー`引数でユニタリー合成プラグインが指定されている場合にのみ、カスタム構成を適用する必要があります。 これが各ユニタリー合成プラグインのカスタムなので、このオプションの使用方法についてはプラグインのドキュメントを参照してください。
    </details>

<details>
  <summary>
    **翻訳ステージ**
  </summary>

-   `translation_method` (str) - 翻訳パスの名前 (`basis_translator`, `translator`, `synthemis`) これは翻訳段階で使用する外部プラグイン名にもなります。 `stage_name`の引数に`translation`を付けた`list_stage_plugins()`を実行することで、インストールされているプラグインのリストを見ることができます。 デフォルト値は `basis_translator` です。
    </details>

<details>
  <summary>
    **Layout stage**
  </summary>

-   `initial_layout` (Layout | Dict | List) - 物理キュービット上の仮想キュービットの初期位置。 このレイアウトで `coupling_map` 制約と互換性のある回路が使用されます。 トランスパイラーがスワップやその他の手段を通じてqubits を許容する可能性があるため、最終的なレイアウトが同じであることは保証されません。 詳細については、format@@0(common-parameters#initial-layout) を参照してください。
-   `layout_method` (str) - レイアウト選択パスの名前 (`trivial`, `dense`, `noise_adaptive`, `sabre`) これは、レイアウトステージに使用する外部プラグイン名にもなります。 `stage_name` の引数に `layout` を付けた `list_stage_plugins()` を実行することで、インストールされているプラグインのリストを見ることができます。 デフォルト値は `sabre` です。
    </details>

<details>
  <summary>
    **ルーティングステージ**
  </summary>

-   `routing_method` (str) - ルーティングパスの名前 (`basic`, `lookahead`, `stochastic`, `sabre`, `none`) これは、ルーティングステージに使用する外部プラグイン名にもなります。 `stage_name`引数に`routing`を付けた`list_stage_plugins()`を実行することで、インストールされているプラグインのリストを見ることができます。 デフォルト値は `sabre` です。
    </details>

<details>
  <summary>
    **最適化ステージ**
  </summary>

-   `approximation _degree` (float, in the range 0-1 | None) - 回路近似に使用されるヒューリスティックダイアル(1.0 = no approximal , 0.0 = maximum approxation). デフォルト値は 1.0 です。  `None` を指定すると、報告されるエラー率に近似度を設定します。 詳細は format@@0(common-parameters#approx-degree) を参照してください。
-   `optimization_level` (int) - 回路でどの程度の最適化を実行するか。 範囲内の整数 (0 - 3) レベルが高いほど最適化された回路が生成され、移調時間が長くなります。 デフォルトは `1` です。 詳細は format@@0(set-optimization) をご覧ください。
-   `optimization_method` (str) - 最適化ステージに使用するプラグイン名。 デフォルトでは外部プラグインは使用されていません。 `stage_name`引数に`optimization`を付けた`list_stage_plugins()`を実行することで、インストールされているプラグインのリストを見ることができます。
    </details>

<details>
  <summary>
    **スケジュールステージ**
  </summary>

-   `scheduling_method` (str) - スケジューリングパスの名前。 これは、スケジューリング段階で使用する外部プラグイン名にもなります。 `stage_name`の引数に`scheduling`を付けて`list_stage_plugins()`を実行することで、インストールされているプラグインのリストを見ることができます。
    -   'as_soon_as_possible': qubit リソースでできるだけ早く命令を貪欲にスケジュールします。 (別名: `asap`) 
    -   'as_late_as_possible': 可能な場合は、qubit をグランド状態に保ち、命令を遅くスケジュールします。 (alias: `alap`).  これがデフォルトです。 
        </details>

<details>
  <summary>
    **Transpiler execution**
  </summary>

`callback` (Callable\[[BasePass, DAGCircuit, float, PropertySet, int], Any]) - コールバック関数は、パスの実行後に呼び出される関数です。 これはデバッグに便利です。 transpiler は回路を実質的に変換するため、コールバックメカニズムは、各パスの後にトランスパイラーが行っていることを理解するのに役立ちます。 例えば、予期しない回路が表示された場合は、コールバックを記述して回路を描画し、パスごとにパス名を出力することができます。

関数はこれらのキーワード引数で呼び出されます:

-   `pass_`: パスを実行します。 
-   `dag`: パスのダグ出力。 
-   `time`: パスを実行する時間。 
-   `property_set`: プロパティセット。 
-   `count`: パス実行のインデックス。 

<Admonition type="note"> 
    渡された引数はパスマネージャの内部を公開し、パスマネージャの内部が変更されると変更されることがあります。 複数のリリースでコールバック関数を再利用する場合は、渡される引数が同じであることを確認してください。 
  </Admonition>
  
  コールバック機能を使用するには、kwargs dict に取得し、変数にアクセスする関数を定義します。 例:

```python
def callback_func(**kwargs):
    pass_ = kwargs['pass_']
    dag = kwargs['dag']
    time = kwargs['time']
    property_set = kwargs['property_set']
    count = kwargs['count']
    ...
transpile(circ, callback=callback_func)
```

-   `seed_transpiler` (int) - トランスパイラーの確率部分のランダムなシードを設定します。
-   `output_name` (str | List[str]) - 出力回路を識別する文字列付きのリスト。 リストの長さは回路パラメータと同じ長さにする必要があります。
    </details>

<Admonition>
上記のパラメータを指定しない場合、次のデフォルト値が使用されます。

```python
qiskit.compiler.transpile(unitary_synthesis_method='default', translation_method='basis_translator', layout_method='sabre', routing_method='sabre', approxation_degree=1.0, optimization_level=1.0, scheduling_method='as_late_as_possible')
```

</Admonition>

## 次のステップ

<Admonition type="tip" title="Recommendations">
    - format@@2(set-optimization) の方法を学びます。
    - format@@0(common-parameters) をレビューします。
    - Learn how to [Set the optimization level when using Qiskit Runtime.](../run/advanced-runtime-options)
    - Visit the [Transpile with pass managers](transpile-with-pass-managers) topic.
    - For examples, see [Representing quantum computers.](representing_quantum_computers)
    - Try the [Submit transpiled circuits](https://learning.quantum.ibm.com/tutorial/submit-transpiled-circuits) tutorial.
    - format@@0(https://learning.quantum.ibm.com/tutorial/redule-transpiled-circuit-depth-with-circuit-cuting) チュートリアルの Qiskit パターンでトランスパレーションを使用します。
    - [Transpile API documentation](/api/qiskit/transpiler) をレビューします。
</Admonition>
