---
title: 実行時のコンパイルを構成
description: ランタイムコンパイル技術の使い方
---

# Qiskit Runtimeのランタイムコンパイルを設定します

ランタイムコンパイル技術は、エラーを最小限に抑えるために回路を最適化し、変換します。 ランタイムコンパイルでは、全体的なランタイムにいくつかの古典的な前処理オーバーヘッドが追加されます。 したがって、あなたの結果を完成させることと、あなたの仕事が妥当な時間内に完了することを確実にすることのバランスを達成することが重要です。

プリミティブでは、最適化レベル (`optimization_level` オプション) を設定し、高度なランタイムコンパイルオプションを選択することで、ランタイムコンパイルを使用できます。

## 最適化レベルを設定する

`optimization_level` 設定は、回路で実行する最適化の量を指定します。 より高いレベルでは、コンパイル時間が長くなるため、より最適化された回路が生成されます。

<Admonition>
  現在の原始バージョンでは、最適化レベル2と3はレベル1と同じように動作します。
</Admonition>

<Table>
  <thead>
    <Tr>
      <Th>Optimization Level</Th>
      <Th>Estimator & Sampler</Th>
    </Tr>
  </thead>
  <tbody>
    <Tr>
      <Td>0</Td>
      <Td>
        No optimization: typically used for hardware characterization or debugging

```
    - Basis translation
    - Layout (as specified)
    - Routing (stochastic swaps)
  </Td>
</Tr>
<Tr>
  <Td>1, 2, 3</Td>
  <Td>
    Light optimization:

    -   Layout (trivial → vf2 → SabreLayout if routing is required)
    -   Routing (SabreSWAPs if needed)
    -   1Q gate optimization
    -   Error suppression: dynamical decoupling
  </Td>
</Tr>
```

</tbody>
</Table>

<Admonition>
  プリミティブは、ターゲットシステムで実行するのに適した形式の回路を期待します。 Qiskitトランスパイラーをローカルで使用して抽象回路をこのターゲット回路形式に変換することができます。 
  
現在、プリミティブは、ターゲット形式ではない回路が与えられた場合、低コストの変換を試みます。 しかし今後原始人はそのような回路でエラーになるでしょう そのため、可能な限り、Qiskit transpiler のローカルコンパイル機能を利用することをお勧めします。
  
  プリミティブクエリの回路準備については、format@@0(https://learning.quantum.ibm.com/tutorial/submiting-user-transpiled-circuits-using-primitives)チュートリアルを参照してください。
</Admonition>

<Admonition type="note">
  Q-CTRLパフォーマンス管理が有効なIBM Cloud Qiskit Runtime サービスインスタンスを使用する場合 戦略に自動プリセットが含まれているので、ランタイム最適化や回復力レベルを指定する必要はありません。
  
  Q-CTRLのデフォルトは `optimization_level=3` と `resilience_level=1` です。
  `optimization_level` または `resilience_level` を 0 に設定すると、
  実行エラーになります。 レベル1、2、3は許可されていますが、パフォーマンスに影響を与えることはありません。
  他のオプションを設定するとパフォーマンスにも影響しなくなり、
  ランタイム警告が発生する可能性があります。 詳細については、format@@0(https://docs.q-ctrl.com/q-ctrl-embedded)をご覧ください。
</Admonition>

### 例: 最適化レベルで推定値を設定する

```python
from qiskit_ibm_runtime import QiskitRuntimeService, Estimator, Options
from qiskit.circuit.library import RealAmplitudes
from qiskit.quantum_info import SparsePauliOp

service = QiskitRuntimeService()
backend = service.backend("ibmq_qasm_simulator")
options = Options(optimization_level=1)

psi = RealAmplitudes(num_qubits=2, reps=2)
H = SparsePauliOp.from_list([("II", 1), ("IZ", 2), ("XI", 3)])
theta = [0, 1, 1, 2, 3, 5]

estimator = Estimator (options=options, backend=backend)

job = estimator.run(circuits=[psi], observables=[H], parameter_values=[theta])
psi1_H1 = job.result()
```

<Admonition type="note">
  最適化レベルが指定されていない場合、サービスは `optimization_level = 1` を使用します。
</Admonition>

### 例: 最適化レベルでサンプラーを構成する

```python
from qiskit_ibm_runtime import QiskitRuntimeService, Sampler, Options

service = QiskitRuntimeService()
backend = service.backend("ibmq_qasm_simulator")
options = Options(optimization_level=1)

samler = Sampler(options=options, backend=backend)
```

<span id="transpilation-table"></span>
## 拡張ランタイムコンパイルオプション

また、ランタイムコンパイル戦略をさらに構成するためのさまざまな高度なオプションを調整することもできます。 これらのメソッドは最適化レベルとともに使用できます。 彼らはあなたが関心のオプションを変更し、あなたの最適化レベルが残りを管理させることができます。

| オプション                                                          | 説明                                                                                                                                                                  |
| -------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| options.transpilation.skip_transpilation (bool)                | 必要なランタイムコンパイルについて最低限必要なプリミティブクエリを実行するようにサービスを指示します。                                                                                                                 |
| options.transpilation.initial_layout(Union\[dict, List, None]) | (非推奨) 物理量子ビット上の仮想量子ビットの初期位置。                                                                                                                                        |
| options.transpilation.layout_method (省略可能:[str])               | (非推奨) レイアウト選択パスの名前。 `trivial`, `dense`, `noise_adaptive`, `sabre`の一つ。                                                                                               |
| options.transpilation.routing_method (省略可能:[str])              | (非推奨) ルーティングパスの名前: `basic` 、 `lookahead` 、 `stochastic` 、 `sabre` 、 `none` 。                                                                                        |
| options.transpilation.approximation_degree（オプション[float]）       | (非推奨) 回路近似のために使用されるヒューリスティックダイアル(1.0=無近似、0.0=最大近似)。 デフォルトでは、すべての最適化レベルの近似がありません                                                                                     |

## 次のステップ

<Admonition type="tip" title="Recommendations">
    - [Variational quantum eigensolver](https://learning.quantum.ibm.com/tutorial/variational-quantum-eigensolver)など、最適化レベルを使用するチュートリアルを試してみてください。
    - [Transpile](../transpile/) セクションでローカルに移調する方法を学びます。
    - format@@0(https://learning.quantum.ibm.com/tutorial/submiting-user-transpiled-circuits-using-primitives) チュートリアルを試してみてください。
</Admonition>
